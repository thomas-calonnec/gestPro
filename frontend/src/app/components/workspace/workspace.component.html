
<!--<div class="workspace-header-gradient">-->
<!--  <h1 class="workspace-title-gradient">{{this.mainService.getWorkspace()}}</h1>-->
<!--</div>-->
<div class="page-header">
  <h1 class="title pill">Your boards</h1>
</div>
<div style="margin-left: 20px;margin-bottom: 20px;">
  <a routerLink="/home">Home</a>
  <span> &gt; </span>
  <a [routerLink]="['/users/',localStorage.getItem('USER_ID'),'workspaces']">Your workspaces</a>
  <span> &gt; </span>
 <span>{{ this.mainService.workspace() }}</span>

</div>
<div>
  <button mat-flat-button style="text-decoration: none; border-radius: 5px; margin-left: 10px" (click)="this.boardCreated = true">
    <i class="fa fa-plus"></i> add a board
  </button>
</div>


<div class="containerBoard">
  <div class="board-search-wrapper">
    <input
      type="text"
      placeholder="Search project..."
      [(ngModel)]="searchTerm"
      class="board-search"
    />
  </div>
  @if (boardCreated) {

    <div class="cards-container">
    <div class="card">
      <form [formGroup]="myForm" (ngSubmit)="addBoard()" >
        <div class="card-header">
          <label for="cardTitle">Titre :</label>
          <input id="cardTitle" type="text" formControlName="name"/>

          <span class="status-badge">ðŸŸ¡ En cours</span>
        </div>

        <div class="card-description">
          <label for="cardDescription">Description :</label>
          <textarea
            id="cardDescription"
            formControlName="description"
            rows="4"
            maxlength="200"
            required
          ></textarea>
          <mat-hint align="end">{{ description().length || 0 }}/200</mat-hint>


        </div>
        <div class="card-description">
          <label for="cardDescription">Members :</label>
          <mat-form-field appearance="outline">
          <mat-chip-grid #chipGrid aria-label="Member selection">
            @for (user of this.users(); track user.id) {
              <mat-chip-row (removed)="remove(user)">

                <img
                  matChipAvatar
                  [src]="user.pictureUrl"
                  [alt]="user.username"
                />{{user.username}}

                <button matChipRemove [attr.aria-label]="'remove ' + user.username">
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>
            }
          </mat-chip-grid>
          <input
            name="currentUser"
            placeholder="New member..."
            #memberInput
            [formControl]="currentUser"
            [matChipInputFor]="chipGrid"
            [matAutocomplete]="auto"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"

          />
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event); memberInput.value = ''">
            @for (user of filteredUser(); track user.username) {
              <mat-option [value]="user.username"> {{user.username}}</mat-option>
            }
          </mat-autocomplete>
          </mat-form-field>
        </div>

        <div class="card-footer">

        <div style="display: flex;justify-content: space-between">
          <button class="btn-open" type="submit">Create</button>
          <a class="btn-closed" (click)="cancel()" >Cancel</a>
        </div>

      </div>
</form>

    </div>

    </div>

    <!--
          <form  [formGroup]="myForm" (ngSubmit)="addBoard()" style="background-color: white; border-radius: 12px ;">
            <div class="myInput">
              <p>name</p>
              <input type="text"  class="form-control h-25 opacity-75" style="background-color: whitesmoke;font-weight: bold" formControlName="name" maxlength="512" required="required" aria-label="Small"  placeholder="Enter board name" aria-describedby="inputGroup-sizing-sm">
              <p>description</p>
              <textarea  class="form-control h-25 opacity-75" style="background-color: whitesmoke;font-weight: bold" formControlName="description" maxlength="512"  aria-label="Small"  placeholder="Enter description" aria-describedby="inputGroup-sizing-sm"></textarea>
            </div>
            <button type="submit" class="btn btn-sm" style="margin: 10px; background-color: #579DFF; text-decoration: none;"> Add board </button>
            <button type="submit"  style="background-color: darkgrey; color:white " class="btn btn-light btn-sm" (click)="this.boardCreated = false" ><i class="fa-solid fa-times" ></i></button>
          </form>
    -->

  }
  <div class="cards-container">
  @for (board of filteredBoard(); track board.id) {

      <div class="card">
        <div class="card-header">
          <h3>{{ board.name }}</h3>
          <span class="status-badge">ðŸŸ¡ En cours</span>
        </div>
        {{board.description}}
        <div class="card-body">
          @if (board.weeksSinceUpdate > 0) {
            <p class="board-meta" style="padding-left: 15px">Updated {{board.weeksSinceUpdate}} {{board.daysSinceUpdate > 1 ? "weeks": "week"}} ago</p>
          }
          @else if (board.daysSinceUpdate > 0){
            <p class="board-meta" style="padding-left: 15px">Updated {{board.daysSinceUpdate}} {{board.daysSinceUpdate > 1 ? "days": "day"}} ago</p>
          } @else if (board.hoursSinceUpdate > 0) {
            <p class="board-meta" style="padding-left: 15px">Updated {{board.hoursSinceUpdate}} {{board.hoursSinceUpdate > 1 ? "hours": "hour"}} ago</p>
          } @else if(board.minutesSinceUpdate > 0){
            <p class="board-meta" style="padding-left: 15px">Updated {{board.minutesSinceUpdate}} {{board.minutesSinceUpdate > 1 ? "minutes": "minute"}} ago</p>
          } @else {
            <p class="board-meta" style="padding-left: 15px">Updated {{board.secondsSinceUpdate}} {{board.minutesSinceUpdate > 1 ? "seconds": "second"}} ago</p>
          }

        </div>

        <div class="card-footer">
          <div class="members">
            ðŸ‘¥ {{board.members.length }} {{board.members.length > 1 ?  "members" : "member"}}
          </div>
          <div class="members">
            {{board.cardCount}} {{board.cardCount > 1 ? "cards" : "card"}}
          </div>
          <div>
            @if (board.ownerId == Number(localStorage.getItem("USER_ID"))) {
              <a href="#"><img ngSrc="./square-pen.png" alt="pen" width="20" height="20" style="margin-right: 20px"/></a>
            }
            <a [routerLink]="'/boards/' + board.id" class="btn-open">Open</a>

          </div>

        </div>
      </div>

  }
  </div>



</div>
